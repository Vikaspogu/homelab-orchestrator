# Configure CloudStack Kubernetes Service settings using ngine_io.cloudstack collection
---
- name: Set Kubernetes cluster network offering
  ngine_io.cloudstack.configuration:
    api_url: "{{ cloudstack_api_url }}"
    api_key: "{{ cloudstack_api_key }}"
    api_secret: "{{ cloudstack_api_secret }}"
    name: "cloud.kubernetes.cluster.network.offering"
    value: "{{ cloudstack_kubernetes_network_offering }}"
    api_timeout: 300
  when: cloudstack_kubernetes_network_offering | length > 0

- name: Enable experimental features if requested
  ngine_io.cloudstack.configuration:
    api_url: "{{ cloudstack_api_url }}"
    api_key: "{{ cloudstack_api_key }}"
    api_secret: "{{ cloudstack_api_secret }}"
    name: "cloud.kubernetes.cluster.experimental.features.enabled"
    value: "true"
    api_timeout: 300
  when: cloudstack_kubernetes_experimental_features

- name: Display configuration summary
  ansible.builtin.debug:
    msg: |
      CloudStack Kubernetes Service Configuration:
      - Kubernetes Service: {{ 'enabled' if cloudstack_kubernetes_enabled else 'disabled' }}
      - Endpoint URL: {{ cloudstack_endpoint_url }}
      - Network Offering: {{ cloudstack_kubernetes_network_offering }}
      - Experimental Features: {{ cloudstack_kubernetes_experimental_features }}

      NOTE: Restart CloudStack Management Server to apply changes:
        systemctl restart cloudstack-management

