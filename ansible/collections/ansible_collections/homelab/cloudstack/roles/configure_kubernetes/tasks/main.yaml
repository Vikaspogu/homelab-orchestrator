# Configure Kubernetes Role - Main Tasks
# Enables and configures CloudStack Kubernetes Service (CKS)
---
- name: Validate required variables
  ansible.builtin.assert:
    that:
      - cloudstack_api_url is defined
    fail_msg: 'Required CloudStack API configuration variables are not set'

- name: Get CloudStack API authentication
  ansible.builtin.include_role:
    name: homelab.cloudstack.api_auth
  when: cloudstack_session_key is not defined

# Kubernetes service configuration
- name: Enable Kubernetes Service
  ansible.builtin.import_tasks: enable_kubernetes.yaml
  tags:
    - enable

- name: Configure Kubernetes settings
  ansible.builtin.import_tasks: configure_kubernetes_settings.yaml
  tags:
    - config
    - settings

- name: Create Kubernetes compute offering
  ansible.builtin.import_tasks: create_kubernetes_offering.yaml
  when: configure_kubernetes_compute_offering.name | length > 0
  tags:
    - offering

- name: Add Kubernetes supported versions
  ansible.builtin.import_tasks: add_kubernetes_versions.yaml
  when: configure_kubernetes_versions | length > 0
  tags:
    - versions
