# CloudStack Network Bridge Configuration
# Managed by Ansible - Do not edit manually

auto lo
iface lo inet loopback

# Primary network interface
auto {{ prepare_kvm_mgmt_interface }}
iface {{ prepare_kvm_mgmt_interface }} inet manual

{% if prepare_kvm_network_mode == 'advanced' and prepare_kvm_guest_interface != prepare_kvm_mgmt_interface %}
# Secondary network interface for guest traffic
auto {{ prepare_kvm_guest_interface }}
iface {{ prepare_kvm_guest_interface }} inet manual
{% endif %}

{% if prepare_kvm_network_mode == 'basic' and prepare_kvm_guest_vlan %}
# VLAN interface for guest traffic (Basic Network)
auto {{ prepare_kvm_mgmt_interface }}.{{ prepare_kvm_guest_vlan }}
iface {{ prepare_kvm_mgmt_interface }}.{{ prepare_kvm_guest_vlan }} inet manual
    vlan-raw-device {{ prepare_kvm_mgmt_interface }}
{% endif %}

# Management network bridge (cloudbr0)
auto {{ prepare_kvm_mgmt_bridge }}
iface {{ prepare_kvm_mgmt_bridge }} inet static
    bridge_ports {{ prepare_kvm_mgmt_interface }}
    bridge_fd {{ prepare_kvm_bridge_fd }}
    bridge_stp {{ prepare_kvm_bridge_stp }}
    bridge_maxwait {{ prepare_kvm_bridge_maxwait }}
    address {{ prepare_kvm_mgmt_ip }}
    netmask {{ prepare_kvm_mgmt_netmask }}
    gateway {{ prepare_kvm_mgmt_gateway }}
    dns-nameservers {{ prepare_kvm_mgmt_dns | join(' ') }}
{% if prepare_kvm_mgmt_domain %}
    dns-domain {{ prepare_kvm_mgmt_domain }}
{% endif %}

# Guest network bridge (cloudbr1)
auto {{ prepare_kvm_guest_bridge }}
iface {{ prepare_kvm_guest_bridge }} inet manual
{% if prepare_kvm_network_mode == 'advanced' %}
    bridge_ports {{ prepare_kvm_guest_interface }}
{% elif prepare_kvm_network_mode == 'basic' and prepare_kvm_guest_vlan %}
    bridge_ports {{ prepare_kvm_mgmt_interface }}.{{ prepare_kvm_guest_vlan }}
{% else %}
    bridge_ports none
{% endif %}
    bridge_fd {{ prepare_kvm_bridge_fd }}
    bridge_stp {{ prepare_kvm_bridge_stp }}
    bridge_maxwait {{ prepare_kvm_bridge_maxwait }}
