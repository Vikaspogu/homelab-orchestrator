# Prepare Management Role - Main Tasks
---
- name: Verify supported OS family
  ansible.builtin.fail:
    msg: "This role only supports Debian/Ubuntu. Detected: {{ ansible_os_family }}"
  when: ansible_os_family != "Debian"

- name: Include OS-specific variables
  ansible.builtin.include_vars: "Debian.yml"
  tags:
    - always

- name: Prepare the Operating System
  ansible.builtin.include_tasks: prepare_os.yml
  tags:
    - prepare
    - os

- name: Configure CloudStack repository
  ansible.builtin.include_tasks: configure_repo.yml
  tags:
    - repository
    - repo

- name: Install and configure MySQL database
  ansible.builtin.include_tasks: install_mysql.yml
  tags:
    - database
    - mysql

- name: Install and configure CloudStack Management Server
  ansible.builtin.include_tasks: install_cloudstack.yml
  tags:
    - cloudstack
    - management

- name: Setup NFS storage
  ansible.builtin.include_tasks: setup_nfs.yml
  when: cloudstack_nfs_enabled | bool
  tags:
    - nfs
    - storage
