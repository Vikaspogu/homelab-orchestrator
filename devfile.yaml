schemaVersion: 2.2.0
metadata:
  name: homelab-orchestrator
components:
  - name: tooling-container
    container:
      image: quay.io/rhn_gps_vpogu/ansible-creator-ee@sha256:169561b14529f1d487a78935db14d7426a9fde7cac7d5fee2fa60f413f8999cf
      memoryRequest: 256M
      memoryLimit: 6Gi
      cpuRequest: 250m
      cpuLimit: 2000m
      args: ['tail', '-f', '/dev/null']
      env:
        - name: SHELL
          value: '/bin/zsh'
        - name: VSCODE_DEFAULT_WORKSPACE
          value: '/projects/homelab-orchestrator/code-workspace'
        - name: 'ANSIBLE_COLLECTIONS_PATH'
          value: '~/.ansible/collections:/usr/share/ansible/collections'
        - name: 'ANSIBLE_CONFIG'
          value: '/projects/homelab-orchestrator/ansible.cfg'
commands:
  - id: install-collections
    exec:
      label: '1. Install Ansible Collections'
      commandLine: 'source $HOME/.bashrc && ansible-galaxy collection install -r requirements.yaml --force'
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      group:
        kind: build
        isDefault: true
      component: tooling-container

  - id: cloudstack-prepare-management
    exec:
      label: '2. CloudStack: Prepare Management'
      commandLine: 'source $HOME/.bashrc && ansible-playbook ansible/playbooks/cloudstack/01-prepare-management.yml'
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      group:
        kind: run
        isDefault: false
      component: tooling-container

  - id: cloudstack-prepare-kvm
    exec:
      label: '3. CloudStack: Prepare KVM'
      commandLine: 'source $HOME/.bashrc && ansible-playbook ansible/playbooks/cloudstack/02-prepare-kvm.yml'
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      group:
        kind: run
        isDefault: false
      component: tooling-container

  - id: cloudstack-configure
    exec:
      label: '4. CloudStack: Configure'
      commandLine: 'source $HOME/.bashrc && ansible-playbook ansible/playbooks/cloudstack/03-configure.yml'
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      group:
        kind: run
        isDefault: false
      component: tooling-container

  - id: cloudstack-kubernetes-setup
    exec:
      label: '5. CloudStack: Kubernetes Setup'
      commandLine: 'source $HOME/.bashrc && ansible-playbook ansible/playbooks/cloudstack/04-kubernetes-setup.yml'
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      group:
        kind: run
        isDefault: false
      component: tooling-container

  - id: cloudstack-instances
    exec:
      label: '6. CloudStack: Instances'
      commandLine: 'source $HOME/.bashrc && ansible-playbook ansible/playbooks/cloudstack/05-instances.yml'
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      group:
        kind: run
        isDefault: false
      component: tooling-container

  - id: cloudstack-kubernetes-cluster
    exec:
      label: '7. CloudStack: Kubernetes Cluster'
      commandLine: 'source $HOME/.bashrc && ansible-playbook ansible/playbooks/cloudstack/06-kubernetes-cluster.yml'
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      group:
        kind: run
        isDefault: false
      component: tooling-container

  - id: cloudstack-cleanup
    exec:
      label: '8. CloudStack: Cleanup'
      commandLine: 'source $HOME/.bashrc && ansible-playbook ansible/playbooks/cloudstack/99-cleanup.yml'
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      group:
        kind: run
        isDefault: false
      component: tooling-container

  - id: openshift-cluster-prep
    exec:
      label: '9. OpenShift: Cluster Prep'
      commandLine: 'source $HOME/.bashrc && ansible-playbook ansible/playbooks/openshift/cluster-prep.yaml'
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      group:
        kind: run
        isDefault: false
      component: tooling-container

  - id: openshift-gitops-bootstrap
    exec:
      label: '10. OpenShift: GitOps Bootstrap'
      commandLine: 'source $HOME/.bashrc && ansible-playbook ansible/playbooks/openshift/gitops-bootstrap.yaml'
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      group:
        kind: run
        isDefault: false
      component: tooling-container

  - id: awx-config
    exec:
      label: '11. AWX: Configure'
      commandLine: 'source $HOME/.bashrc && ansible-playbook ansible/playbooks/awx/config.yaml'
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      group:
        kind: run
        isDefault: false
      component: tooling-container

  - id: ansible-navigator
    exec:
      label: 'Ansible-Navigator: Start ansible-navigator'
      commandLine: |
        if [ ! -d "$HOME/.cache/ansible-navigator" ]; then
          mkdir -p "$HOME/.cache/ansible-navigator"
        fi
        cp /usr/local/lib/python3.11/site-packages/ansible_navigator/data/catalog_collections.py $HOME/.cache/ansible-navigator
        ansible-navigator --ee false
      workingDir: ${PROJECTS_ROOT}/homelab-orchestrator
      component: tooling-container
